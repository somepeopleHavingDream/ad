# Spring Cloud微服务架构 设计实现广告系统
## 第1章 课程简介
## 第2章 广告系统概览与准备工作
- 广告系统实现了什么样的功能
    - 广告主的广告投放
        - 推广计划
        - 推广单元
        - ……
    - 媒体方的广告投放
        - cpm(cost per mille)
        - cpt(cost per time)
        - cpc(cost per click)
- 一个完整的广告系统包含哪些子系统
    - 广告投放系统（广告系统的基本功能）
        - 既然是广告系统，一定得有广告数据，数据当然是由广告主或代理商投放，那么，也就需要有个投放广告的平台，也就是广告投放系统
    - 广告检索系统（广告系统的基本功能）
        - 媒体方对广告系统发起请求，广告系统能够检索符合要求的广告数据，这就是广告检索系统的核心功能
    - 曝光监测系统
        - 监测广告数据的曝光记录
    - 扣费系统
        - 广告数据报表，比如广告A在地域B中一共曝光了多少次，主要是OLAP的过程
    - 报表系统
        - 广告的每一次曝光都是需要扣费的，且这个系统里面负责了将广告数据置位的功能
    - ……
- 广告投放与检索系统使用了哪些技术
    - SpringCloud
    - MySQL
    - Kafka
    - ……
- 可以怎样扩展当前实现的广告系统
    - 更多的纬度
    - 用户画像
    - AI
    - ……
## 第3章 广告系统骨架开发
- 微服务架构及其应用场景
    - 微服务架构的两种方式
        - 点对点的方式：服务之间直接调用，每个微服务都开放Rest API，并调用其他微服务的接口
        - API-网关方式：业务接口通过API网关暴露，是所有客户端接口的唯一入口。微服务之间的通信也通过API网关
## 第4章 通用模块开发
## 第5章 广告投放系统的开发
- 四个概念（推广计划与推广单元是一对多的关系，推广单元和创意是多对多的关系）
    - 用户账户
    - 推广计划
    - 推广单元
        - 关键词限制
        - 地域限制
        - 兴趣限制
    - 创意
- 广告投放系统的要点
    - 广告投放数据的核心要素
        - 用户账户
            - 最高层级，用于定义广告主或代理商，只有有了用户才会有接下来的数据投放
        - 推广计划
            - 一类品牌或产品广告投放的规划，自身并不定义太多关于广告自身的信息，它会将信息打包下放到推广单元层级
        - 推广单元
            - 一个确定的广告投放策略，描述了投放广告的规则信息
        - 推广单元维度限制
            - 广告投放会有一些限制条件，例如只投放到北京、上海地区，对一些关键字进行投放等等
        - 广告创意
            - 展示给用户看到的数据，可以是图片、文本或者一段视频
    - 广告投放系统的核心功能
        - 投放系统是比较简单的模块，其核心实现的功能就是对广告数据（各个表）进行增删查改，即能够让用户（广告主/代理商）对数据进行查看、上传、修改与删除
## 第6章 广告检索系统-微服务调用
## 第7章 广告检索系统-广告数据索引的设计与实现
- 广告数据索引的设计
    - 正向索引（推广计划、推广单元、创意）
        - 通过唯一键/主键生成与对象的映射关系
    - 倒排索引（创意与推广单元的关联对象、推广单元地域限制、推广单元兴趣限制、推广单元关键词限制）
        - 也被称作是反向索引，是一种索引方法，它的设计是为了存储在全文搜索下某个单词在一个文档或一组文档中存储位置的映射。是在文档检索系统中最常用的数据结构
        - 倒排索引在广告系统中的应用
            - 核心用途是对各个维度限制的“整理”
- 全量索引+增量索引
    - 全量索引和增量索引的解释
        - 全量索引：检索系统在启动时一次性读取当前数据库中（注意，不能直接从数据库中直接读取？）的所有数据，建立索引
        - 增量索引：系统运行过程中，监控数据库变化，即增量，实时加载更新，构建索引
## 第8章 广告检索系统-加载全量索引
## 第9章 广告检索系统-监听Binlog构造增量数据
- MySQL Binlog
    - 什么是Binlog？
        - 二进制日志，记录对数据发送或潜在发生更改的SQL语句，并以二进制的形式保存在磁盘中
    - Binlog的作用是什么？
        - 有两个主要的作用：复制、恢复和审计
    - Binlog日志的三种格式
        - Row
            - 仅保存记录被修改细节，不记录sql语句上下文相关信息
        - STATEMENT
            - 每一条会修改数据的sql都会记录在Binlog中
        - MIXED
            -  以上两种level的混合使用
    - Binlog中的Event_type
        - QUERY_EVENT
            - 与数据无关的操作，begin、droptable、truncate table等
        - TABLE_MAP_EVENT
            - 记录下一个操作所对应的表信息，存储了数据库名和表名
        - XID_EVENT
            - 标记事务提交
        - WRITE_ROWS_EVENT
            - 插入数据，即insert操作
        - UPDATE_ROWS_EVENT
            - 更新数据，即update操作
        - DELETE_ROWS_EVENT
            - 删除数据，即delete操作
## 第10章 广告检索系统-Binlog增量数据的投递
## 第11章 广告检索系统-广告检索服务
- 广告检索服务
    - 核心思想是什么
        - 媒体方发起广告请求（详细地表达自己的意图），检索服务检索广告数据（条件匹配过程），返回响应
        - 广告数据是围绕推广单元的，所有的匹配信息应该是集中到推广单元中
        - 高效地对广告数据进行检索，尽可能低的延迟，所以，需要设计并构建合理的索引结构
        - 保证索引与数据库中存储的数据是一致的，即全量索引+增量索引
    - 媒体方的请求包含的三个要素
        - 媒体方的请求标识mediaId
        - 请求基本信息RequestInfo：requestId、adSlots、App、Geo、Device
        - 匹配信息FeatureInfo：KeywordFeature、DistrictFeature、ItFeature、FeatureRelation
    - 检索服务的响应
        - Map<String, List>adSlot2Ads：key是广告位编码，能够唯一地标识一个广告位，value是提供给广告位的广告数据
    - 检索服务的匹配过程
        - 根据广告位类型对推广单元进行预筛选
        - 根据各个Feature对推广单元进行再过滤
        - 对推广单元以及推广计划的状态进行过滤
        - 创意信息与广告位信息的匹配
## 第12章 Kafka的安装与使用
## 第13章 熔断监控Hystrix Dashboard
## 第14章 广告系统的可用性测试
## 第15章 课程总结